{% extends "base.html" %}

{% block title %}Leaderboard - {{ contest.name }}{% endblock %}

{% block content %}
<div class="nav">
    <div>
        <strong>{{ contest.name }}</strong> - Leaderboard
    </div>
    <div>
        <a href="/contest/{{ contest.id }}/problems">Problems</a>
        {% if let Some(user) = username %}
            <span>{{ user }}</span>
        {% endif %}
    </div>
</div>

<div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
    <h2 style="font-size: 1.875rem; margin-bottom: 24px;">Final Standings</h2>

    <div style="background-color: #1e293b; border-radius: 8px; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
            <thead>
                <tr style="background-color: #0f172a;">
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600;">Rank</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600;">Username</th>
                    <th style="padding: 12px 16px; text-align: right; font-weight: 600;">Score</th>
                    <th style="padding: 12px 16px; text-align: center; font-weight: 600;">ðŸ’Ž</th>
                    <th style="padding: 12px 16px; text-align: center; font-weight: 600;">ðŸ¥‡</th>
                    <th style="padding: 12px 16px; text-align: center; font-weight: 600;">Solved</th>
                    {% for pid in problem_ids %}
                        <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.875rem;">P{{ loop.index }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for (idx, entry) in entries.iter().enumerate() %}
                <tr style="border-top: 1px solid #334155;">
                    <td style="padding: 12px 16px; color: #94a3b8;">{{ idx + 1 }}</td>
                    <td style="padding: 12px 16px; font-weight: 500;">
                        {{ entry.username }}
                    </td>
                    <td style="padding: 12px 16px; text-align: right; color: #fbbf24; font-weight: 600;">
                        {{ entry.total_score }}
                    </td>
                    <td style="padding: 12px 16px; text-align: center;">
                        {% if entry.diamonds > 0 %}
                            <span style="color: #60a5fa;">{{ entry.diamonds }}</span>
                        {% else %}
                            <span style="color: #374151;">-</span>
                        {% endif %}
                    </td>
                    <td style="padding: 12px 16px; text-align: center;">
                        {% if entry.golds > 0 %}
                            <span style="color: #fbbf24;">{{ entry.golds }}</span>
                        {% else %}
                            <span style="color: #374151;">-</span>
                        {% endif %}
                    </td>
                    <td style="padding: 12px 16px; text-align: center; color: #94a3b8;">
                        {{ entry.problems_solved }}
                    </td>
                    {% for result in entry.problem_results %}
                        <td style="padding: 12px 8px; text-align: center; font-size: 0.75rem;">
                            {% if let Some(r) = result %}
                                {% if r.medal == "diamond" %}
                                    <span style="color: #60a5fa; font-weight: 700;" title="{{ r.code_length }} bytes">ðŸ’Ž</span>
                                {% else if r.medal == "gold" %}
                                    <span style="color: #fbbf24; font-weight: 700;" title="{{ r.code_length }} bytes">ðŸ¥‡</span>
                                {% else %}
                                    <span style="color: #94a3b8;" title="{{ r.code_length }} bytes">âœ“</span>
                                {% endif %}
                            {% else %}
                                <span style="color: #374151;">-</span>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="margin-top: 24px; padding: 16px; background-color: #1e293b; border-radius: 8px; color: #94a3b8; font-size: 0.875rem;">
        <h3 style="font-size: 1rem; margin-bottom: 8px; color: #e5e7eb;">Scoring Rules</h3>
        <ul style="list-style: disc; padding-left: 20px; line-height: 1.75;">
            <li><strong style="color: #60a5fa;">ðŸ’Ž Diamond (10,000 points)</strong>: Unique shortest solution for a problem (only one person has it)</li>
            <li><strong style="color: #fbbf24;">ðŸ¥‡ Gold (10,000 points)</strong>: Shared shortest solution (multiple people have the same best)</li>
            <li><strong>Bronze</strong>: Solved but not shortest (10,000 Ã— best_length / your_length points)</li>
            <li>Ties broken by total bytes (lower is better)</li>
        </ul>
    </div>
</div>
{% endblock %}
