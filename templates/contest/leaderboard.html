{% extends "base.html" %}

{% block title %}Leaderboard - {{ contest.name }}{% endblock %}

{% block content %}
<div class="nav">
    <div>
        <strong>{{ contest.name }}</strong> - Leaderboard
    </div>
    <div>
        <a href="/">Home</a>
        {% if contest.status == "active" %}
            <a href="/contest/{{ contest.id }}/problems">Problems</a>
        {% endif %}
        {% if let Some(user) = username %}
            <span>{{ user }}</span>
        {% endif %}
    </div>
</div>

<div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
    <h2 style="font-size: 1.875rem; margin-bottom: 24px;">Final Standings</h2>

    <div style="background-color: #1e293b; border-radius: 8px; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; min-width: 800px; table-layout: fixed;">
            <colgroup>
                <col style="width: 60px;">
                <col style="width: 150px;">
                <col style="width: 80px;">
                <col style="width: 100px;">
                {% for pid in problem_ids %}
                    <col style="width: 80px;">
                {% endfor %}
            </colgroup>
            <thead>
                <tr style="background-color: #0f172a;">
                    <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Rank</th>
                    <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Username</th>
                    <th style="padding: 12px 8px; text-align: center; font-weight: 600;">Solved</th>
                    <th style="padding: 12px 8px; text-align: right; font-weight: 600;">Total</th>
                    {% for pid in problem_ids %}
                        <th style="padding: 12px 8px; text-align: center; font-weight: 600; font-size: 0.875rem;">P{{ loop.index }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for (idx, entry) in entries.iter().enumerate() %}
                <tr style="border-top: 1px solid #334155;">
                    <td style="padding: 12px 8px; color: #94a3b8;">{{ idx + 1 }}</td>
                    <td style="padding: 12px 8px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        {{ entry.username }}
                    </td>
                    <td style="padding: 12px 8px; text-align: center; color: #94a3b8;">
                        {{ entry.problems_solved }}
                    </td>
                    <td style="padding: 12px 8px; text-align: right; color: #fbbf24; font-weight: 600;">
                        {{ entry.total_bytes }}
                    </td>
                    {% for result in entry.problem_results %}
                        <td style="padding: 12px 8px; text-align: center; font-size: 0.875rem; white-space: nowrap;">
                            {% if let Some(r) = result %}
                                {% if r.medal == "diamond" %}
                                    <span style="color: #60a5fa; font-weight: 700;" title="{{ r.code_length }} bytes (unique best!)">ðŸ’Ž {{ r.code_length }}</span>
                                {% else if r.medal == "gold" %}
                                    <span style="color: #fbbf24; font-weight: 700;" title="{{ r.code_length }} bytes (tied best)">ðŸ¥‡ {{ r.code_length }}</span>
                                {% else %}
                                    <span style="color: #94a3b8;" title="{{ r.code_length }} bytes">{{ r.code_length }}</span>
                                {% endif %}
                            {% else %}
                                <span style="color: #374151;">-</span>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="margin-top: 24px; padding: 16px; background-color: #1e293b; border-radius: 8px; color: #94a3b8; font-size: 0.875rem;">
        <h3 style="font-size: 1rem; margin-bottom: 8px; color: #e5e7eb;">Scoring Rules</h3>
        <ul style="list-style: disc; padding-left: 20px; line-height: 1.75;">
            <li><strong>Total Score</strong>: Sum of bytes across all solved problems (lower is better)</li>
            <li><strong style="color: #60a5fa;">ðŸ’Ž Diamond</strong>: Unique shortest solution for a problem (only one person has it)</li>
            <li><strong style="color: #fbbf24;">ðŸ¥‡ Gold</strong>: Tied shortest solution (multiple people have the same best)</li>
            <li>Rankings are determined by: (1) Most problems solved, (2) Lowest total bytes</li>
        </ul>
    </div>
</div>
{% endblock %}
